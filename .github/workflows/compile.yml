name: Build TWRP for A716S

on:
  workflow_dispatch: # Энэ нь товчлуур дарж эхлүүлэх боломжийг олгоно

jobs:
  build:
    runs-on: ubuntu-20.04
    
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Clean Up Disk Space (Зай суллах)
      uses: rohit2801/android-recovery-action@v1
      # Энэ action нь автоматаар Android build хийх орчинг бэлдэж, зай сулладаг.
      # Хэрэв гар аргаар хийх бол доорх коммандуудыг ашигладаг.

    - name: Install Dependencies (Хэрэгтэй зүйлс суулгах)
      run: |
        sudo apt update
        sudo apt -y install git-core gnupg flex bison build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z1-dev libgl1-mesa-dev libxml2-utils xsltproc unzip fontconfig

    - name: Install Repo Tool
      run: |
        mkdir ~/bin
        curl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo
        chmod a+x ~/bin/repo
        export PATH=~/bin:$PATH

    - name: Initialize Repo (Эх код татах - Minimal)
      run: |
        export PATH=~/bin:$PATH
        mkdir workspace
        cd workspace
        # Android 11/12/13 дээр суурилсан TWRP-12.1 салбарыг сонгож байна (A71-д тохиромжтой байх магадлалтай)
        repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_aosp.git -b twrp-12.1
        repo sync -j$(nproc --all) --force-sync

    - name: Clone Device Tree (Таны Device Tree-г хуулах)
      run: |
        cd workspace
        # ЭНД ӨӨРИЙН GITHUB LINK-ЭЭ ТАВИНА UU!!!
        # Жишээ нь: git clone https://github.com/TaniiNer/android_device_samsung_a716s device/samsung/a716s
        git clone https://github.com/INSERT_YOUR_USERNAME/INSERT_YOUR_REPO_NAME device/samsung/a716s

    - name: Build TWRP (Build хийх)
      run: |
        export PATH=~/bin:$PATH
        cd workspace
        export ALLOW_MISSING_DEPENDENCIES=true
        source build/envsetup.sh
        
        # ЭНД LUNCH COMMAND-ИЙГ ШАЛГААРАЙ
        # Таны device tree доторх `vendorsetup.sh` эсвэл `AndroidProducts.mk` дотор нэр нь байгаа.
        # Ихэнхдээ: twrp_a716s-eng эсвэл omni_a716s-eng байдаг.
        lunch twrp_a716s-eng 
        
        mka recoveryimage

    - name: Upload Recovery Image (Файлыг татаж авах)
      uses: actions/upload-artifact@v3
      with:
        name: TWRP-Recovery
        path: workspace/out/target/product/a716s/recovery.img
